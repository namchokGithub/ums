<!--
    Namspace: ~/View/EditProfile/Index.cshtml
    Author: Wannapa Srijermtong
    Description: View for edit profile
-->

@model EditProfile
@{
    ViewData["Title"] = "Edit Profile";
    Layout = "~/Views/Shared/AdminLTE/_Layout.cshtml";

    var editProfile = ViewData["User"] as EditProfile;
}

<div class="mx-auto col-5">
    <br>
    <!--Start Card-->
    <div class="card card-info text-center">
        <!--Start Card header-->
        <div class="card-header">
            <h3 class="card-title">Edit Profile</h3>
        </div>
        <!--End Card header-->
        <!--Start Card body-->
        <div class="card-body">
            <!--Start Form profile-->
            <form id="FormProfile" method="post" asp-action="editProfile" asp-controller="EditProfile">
                <!--Start Input edit profile-->
                <input type="hidden" asp-for="acc_Id" id="acc_Id" value="@editProfile.acc_Id" />
                <div id="acc_Firstname" class="input-group mb-3 col-12">
                    <input class="form-control" id="acc_Fname" type="text" name="acc_Firstname" placeholder="First name" asp-for="acc_Firstname" value="@editProfile.acc_Firstname" />
                    <span id="validation_acc_Firstname" class="text-danger col-12"></span>
                </div>
                <div id="acc_Lastname" class="input-group mb-3 col-12">
                    <input class="form-control" id="acc_Lname" type="text" name="acc_Lastname" placeholder="Last name" asp-for="acc_Lastname" value="@editProfile.acc_Lastname" />
                    <span id="validation_acc_Lastname" class="text-danger col-12"></span>
                </div>

                <!--Start Input change password-->
                <div id="acc_CurrentPassword" class="input-group mb-3 col-12 d-none">
                    <input class="form-control" id="acc_Current" type="password" name="acc_CurrentPassword" placeholder="Current password" />
                    <span id="validation_acc_CurrentPassword" class="text-danger col-12"></span>
                </div>
                <div id="acc_NewPassword" class="input-group mb-3 col-12 d-none">
                    <input class="form-control" id="acc_New" type="password" name="acc_NewPassword" placeholder="New password" />
                    <span id="validation_acc_NewPassword" class="text-danger col-12"></span>
                </div>
                <div id="acc_ConfirmPassword" class="input-group mb-3 col-12 d-none">
                    <input class="form-control" id="acc_Con" type="password" name="acc_ConfirmPassword" placeholder="Confirm password" />
                    <span id="validation_acc_ConfirmPassword" class="text-danger col-12"></span>
                </div>
                <!--End Input change password-->

                <!--Start Button save password-->
                <button id="btn_SavePassword" type="button" class="btn btn-success btn-block d-none" onclick="SavePassword()">Save</button>
                <button id="btn_NotSavePassword" type="button" class="btn btn-secondary btn-block d-none">Back</button>
                <!--End Button save password-->

                <!--End Input edit profile-->
                <!--Start Button save profile-->
                <div class="row">
                    <!--If Login ProviderLogin is Email can change password-->
                    @if (editProfile.acc_TypeAccoutname == "Email")
                    {
                        <div class="col-8">
                            <p id="href_ChangePassword">Change password</p>
                        </div>
                        <div class="col-4">
                            <button id="btn_SaveProfile" type="button" class="btn btn-success btn-block float-right" onclick="SaveProfile()">Save</button>
                        </div>
                    }
                    else
                    {
                        <div class="col-12">
                            <button id="btn_SaveProfile" type="button" class="btn btn-success btn-block float-right" onclick="SaveProfile()">Save</button>
                        </div>
                    }
                </div>
                <!--End Button save profile-->
            </form>
            <!--End Form profile-->
        </div>
        <!--End Card body-->
    </div>
    <!--Stop Card-->
</div>

<!--Start Script-->
<script>
    //Regular expression
    var RegExName = /^[a-zA-Z]+(([a-zA-Z])?[a-zA-Z]*)*$/;
    var RegExPassword = /^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[#$!%@@*?&])[A-Za-z0-9#$!%@@*?&]+$/;

    /*
    * Name: SaveProfile
    * Parameter: none
    * Author: Wannapa Srijermtong
    * Description: Check validation acc_Firstname and acc_Lastname from input.
    */
    function SaveProfile() {
        // Get id from input
        var acc_Firstname = $('#acc_Fname').val();
        var acc_Lastname = $('#acc_Lname').val();

        // Validation if acc_Firstname do not math with Regular expression.
        if (RegExName.test(acc_Firstname) && acc_Firstname != "" && RegExName.test(acc_Lastname) && acc_Lastname != "") {
            $("#FormProfile").submit();
            $('#validation_acc_Firstname').html('');
            $('#validation_acc_Lastname').html('');
        } else {
            if (!RegExName.test(acc_Firstname)) {
                $('#validation_acc_Firstname').html('The First name can not be blank and must only character.');
                toastr.warning('The First name can not be blank and must only character.')
            }
            else if (!RegExName.test(acc_Lastname)) {
                $('#validation_acc_Lastname').html('The Last name can not be blank and must only character.');
                toastr.warning('The Last name can not be blank and must only character.')
            }
        }
    }

    /*
    * Name: SavePassword
    * Parameter: none
    * Author: Wannapa Srijermtong
    * Description: Check validation acc_Firstname, acc_Lastname, acc_CurrentPassword, acc_NewPassword and acc_ConfirmPassword from input.
    */
    function SavePassword() {
        // Get id from input
        var acc_Firstname = $('#acc_Fname').val();
        var acc_Lastname = $('#acc_Lname').val();
        var acc_CurrentPassword = $('#acc_Current').val();
        var acc_NewPassword = $('#acc_New').val();
        var acc_ConfirmPassword = $('#acc_Con').val();

        // Validation if acc_Firstname do not math with Regular expression.
        if (RegExName.test(acc_Firstname) && acc_Firstname != ""
            && RegExName.test(acc_Lastname) && acc_Lastname != ""
            && RegExPassword.test(acc_CurrentPassword) && acc_CurrentPassword != ""
            && RegExPassword.test(acc_NewPassword) && acc_NewPassword != ""
            && RegExPassword.test(acc_ConfirmPassword) && acc_ConfirmPassword != ""
        ){
            $("#FormProfile").submit();
            $('#validation_acc_Firstname').html('');
            $('#validation_acc_Lastname').html('');
            $('#validation_acc_CurrentPassword').html('');
            $('#validation_acc_NewPassword').html('');
            $('#validation_acc_ConfirmPassword').html('');
        } else {
            if (!RegExName.test(acc_Firstname)) {
                $('#validation_acc_Firstname').html('The First name can not be blank and must only character.');
                toastr.warning('The First name can not be blank and must only character.')
            }
            else if (!RegExName.test(acc_Lastname)) {
                $('#validation_acc_Lastname').html('The Last name can not be blank and must only character.');
                toastr.warning('The Last name can not be blank and must only character.')
            }
            else if (!RegExPassword.test(acc_CurrentPassword)) {
                $('#validation_acc_CurrentPassword').html('The password must contain at least <br> 1 uppercase, 1 lowercase, 1 digit and 1 special character.');
                toastr.warning('The current password must contain at least 1 uppercase, 1 lowercase, 1 digit and 1 special character.')
            }
            else if (!RegExPassword.test(acc_NewPassword)) {
                $('#validation_acc_NewPassword').html('The password must contain at least <br> 1 uppercase, 1 lowercase, 1 digit and 1 special character.');
                toastr.warning('The new password must contain at least 1 uppercase, 1 lowercase, 1 digit and 1 special character.')
            }
            else if (!RegExPassword.test(acc_ConfirmPassword)) {
                $('#validation_acc_ConfirmPassword').html('The password must contain at least <br> 1 uppercase, 1 lowercase, 1 digit and 1 special character.');
                toastr.warning('The confirm password must contain at least 1 uppercase, 1 lowercase, 1 digit and 1 special character.')
            }
        }
    }

    $(document).ready(function () {
        //Hide href and button SaveProfile for Change password
        $("#href_ChangePassword").click(function () {
            $("#href_ChangePassword").hide();
            $("#btn_SaveProfile").hide();
            $("#acc_CurrentPassword").removeClass('d-none');
            $("#acc_NewPassword").removeClass('d-none');
            $("#acc_ConfirmPassword").removeClass('d-none');
            $("#btn_SavePassword").removeClass('d-none');
            $("#btn_NotSavePassword").removeClass('d-none');
        });

        $('#btn_NotSavePassword').on('click', () => {
            $("#href_ChangePassword").show();
            $("#btn_SaveProfile").show();
            $("#btn_NotSavePassword").addClass('d-none');
            $("#acc_CurrentPassword").addClass('d-none');
            $("#acc_NewPassword").addClass('d-none');
            $("#acc_ConfirmPassword").addClass('d-none');
            $("#btn_SavePassword").addClass('d-none');
        })

        //Validation for acc_Firstname
        $("#acc_Firstname").keyup(function (e) {
            e.preventDefault();

            // Get id from input
            var acc_Firstname = $('#acc_Fname').val();

            // Validation if acc_Firstname do not math with Regular expression.
            if(!RegExName.test(acc_Firstname)) {
                $('#validation_acc_Firstname').html('The First name can not be blank and must only character.');
            } else {
                $('#validation_acc_Firstname').html('');
            }
        });

        //Validation for acc_Lastname
        $("#acc_Lastname").keyup(function (e) {
            e.preventDefault();

            // Get id from input
            var acc_Lastname = $('#acc_Lname').val();

            // Validation if acc_Lastname do not math with Regular expression.
            if(!RegExName.test(acc_Lastname)) {
                $('#validation_acc_Lastname').html('The Last name can not be blank and must only character.');
            } else {
                $('#validation_acc_Lastname').html('');
            }
        });

        //Validation for acc_ConfirmPassword
        $("#acc_ConfirmPassword").keyup(function (e) {
            e.preventDefault();

            // Get id from input
            var acc_NewPassword = $('#acc_New').val();
            var acc_ConfirmPassword = $('#acc_Con').val();

            // Validation if acc_NewPassword do not match with acc_ConfirmPassword.
            if (acc_NewPassword != acc_ConfirmPassword) {
                $('#validation_acc_ConfirmPassword').html('The new password and confirmation password do not match.');
            } else {
                $('#validation_acc_ConfirmPassword').html('');
            }
        });

        //Validation for acc_CurrentPassword
        $("#acc_CurrentPassword").keyup(function (e) {
            e.preventDefault();

            // Get id from input
            var acc_CurrentPassword = $('#acc_Current').val();

            // Validation if acc_CurrentPassword do not math with Regular expression.
            if (!RegExPassword.test(acc_CurrentPassword)) {
                $('#validation_acc_CurrentPassword').html('The password must contain at least <br> 1 uppercase, 1 lowercase, 1 digit and 1 special character.');
            } else {
                $('#validation_acc_CurrentPassword').html('');
            }
        });

        //Validation for acc_NewPassword
        $("#acc_NewPassword").keyup(function (e) {
            e.preventDefault();

            // Get id from input
            var acc_NewPassword = $('#acc_New').val();

            // Validation if acc_NewPassword do not math with Regular expression.
            if (!RegExPassword.test(acc_NewPassword)) {
                $('#validation_acc_NewPassword').html('The password must contain at least <br> 1 uppercase, 1 lowercase, 1 digit and 1 special character.');
            } else {
                $('#validation_acc_NewPassword').html('');
            }
        });

        // Toastr if current password is not match with password hash in database.
        @if (TempData["EditProfileErrorResult"] != null) { @Html.Raw(TempData["EditProfileErrorResult"])}
        // Toastr if EditProfile (Firstname, Lastname and Change password) Success.
        @if (TempData["EditProfileSuccessResult"] != null) { @Html.Raw(TempData["EditProfileSuccessResult"])}
        // Exeception
        @if (TempData["Exeception"] != null) { @Html.Raw(TempData["Exeception"])}
    })
</script>
<!--End Script-->

<!--Start Style-->
<style>
    @*Style for hyperlink Change password*@
    #href_ChangePassword {
        text-align: left;
        color: blue;
        cursor: pointer;
    }

    @*Style for validation*@
    .text-danger {
        text-align: left;
    }
</style>
<!--End Style-->